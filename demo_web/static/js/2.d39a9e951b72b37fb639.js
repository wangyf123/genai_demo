webpackJsonp([2],{IURr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=r("mvHQ"),a=r.n(s),o={name:"login",data:function(){return{userGroupList:[],activeName:"login",loginForm:{campus_card_id:"",password:""},userForm:{},forgetForm:{},groupOptions:[{label:"teacher",value:2},{label:"student",value:3}],regRules:{user_group_id:[{required:!0,message:"用户组必选",trigger:"blur"}],campus_card_id:[{required:!0,message:"校园卡号必填",trigger:"blur"}],department:[{required:!0,message:"院系必填",trigger:"blur"}],email:[{required:!0,message:"邮箱必填",trigger:"blur"}],name:[{required:!0,message:"用户名必填",trigger:"blur"}],password:[{required:!0,message:"密码必填",trigger:"blur"}]},forgetRules:{email:[{required:!0,message:"邮箱必填",trigger:"blur"}],verification_code:[{required:!0,message:"验证码必填",trigger:"blur"}],password:[{required:!0,message:"密码必填",trigger:"blur"}]}}},methods:{loadUserGroup:function(){var e=this;e.req("/user_group",{},function(t){t&&t.success?e.userGroupList=t.obj.records:e.$alert(t.message,e.$t("tip.tip"),{confirmButtonText:e.$t("button.close"),type:"warning"}).then(function(){}).catch(function(){})},"get",!1)},handleClick:function(e,t){console.log(e,t)},login:function(){var e=this;e.req("/auth",this.loginForm,function(t){console.log(t),t&&t.success?(e.initUserData(t.obj),e.$emit("loginOver")):e.$alert(t.message,e.$t("tip.tip"),{confirmButtonText:e.$t("button.close"),type:"warning"}).then(function(){}).catch(function(){})})},initUserData:function(e){var t=this.m.getData(e.user_group_id).navMap,r=[],s=[];for(var o in t){var i=t[o];for(var l in 0==i.type?r.push(i):s.push(i),i.childMap){var n=i.childMap[l];for(var c in 0==n.type?i.childList.push(n):s.push(n),n.childMap){var u=n.childMap[c];for(var m in 0==u.type?this.menuSort(n.childList,u):s.push(u),u.childMap){var p=u.childMap[m];1==p.type&&s.push(p)}}n.childMap={}}i.childMap={}}sessionStorage.setItem("userMenuArr",a()(r)),sessionStorage.setItem("userFunArr",a()(s)),sessionStorage.setItem("loginUser",e.name),sessionStorage.setItem("user_id",e.id),sessionStorage.setItem("user_group_id",e.user_group_id),sessionStorage.setItem("department",e.department),sessionStorage.setItem("ops-token",e.token)},menuSort:function(e,t){if(void 0==t.idx&&(t.idx=99999),0==e.length)e.push(t);else for(var r in e){if(e[r].idx>t.idx)return e.splice(r,0,t),!0;r==e.length-1&&e.push(t)}},resize:function(){var e=(document.body.clientHeight-550)/2-30;e<0&&(e=0),this.mt=e},execReg:function(){var e=this,t=this;this.$refs.userForm.validate(function(r){r?t.req("/user",e.userForm,function(e){e&&e.success?(t.$message.success("注册成功"),t.activeName="login"):t.$alert(e.message,t.$t("tip.tip"),{confirmButtonText:t.$t("button.close"),type:"warning"}).then(function(){}).catch(function(){})}):t.$message.error("校验失败，请认真填写")})},forgetSub:function(){var e=this;this.$refs.forgetForm.validate(function(t){t?e.req("/user",e.forgetForm,function(t){t&&t.success?(e.$message.success("重置成功"),e.activeName="login"):e.$alert(t.message,e.$t("tip.tip"),{confirmButtonText:e.$t("button.close"),type:"warning"}).then(function(){}).catch(function(){})},"put"):e.$message.error("校验失败，请认真填写")})},toDatav:function(){this.$router.push("/datav")},toSendVcode:function(){var e=this,t=this.forgetForm.email;if(t){var r={email:t};this.req("/verification_code",r,function(t){t&&t.success?e.$message.success("Success"):e.$alert(t.message,e.$t("tip.tip"),{confirmButtonText:e.$t("button.close"),type:"warning"}).then(function(){}).catch(function(){})})}else this.$message.error("请填写邮箱")}},mounted:function(){this.$nextTick(function(){console.log("mounted -- >");var e=this;this.resize(),window.addEventListener("resize",function(){e.resize()})})}},i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"main"},[r("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{label:"　登录　",name:"login"}},[r("div",{staticClass:"loginForm"},[r("el-form",{ref:"loginForm",attrs:{model:e.loginForm,"label-width":"100px",size:"small"}},[r("el-form-item",{attrs:{label:e.$t("login.campus_card_id")}},[r("el-input",{staticClass:"logInt",attrs:{placeholder:e.$t("login.campus_card_id"),type:"text",clearable:""},model:{value:e.loginForm.campus_card_id,callback:function(t){e.$set(e.loginForm,"campus_card_id",t)},expression:"loginForm.campus_card_id"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("login.password")}},[r("el-input",{staticClass:"logInt",attrs:{placeholder:e.$t("login.password"),type:"password",clearable:"","show-password":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login()}},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1)],1),e._v(" "),r("el-button",{staticClass:"loginBtn",attrs:{type:"primary"},on:{click:e.login}},[e._v(e._s(e.$t("login.btn")))])],1)]),e._v(" "),r("el-tab-pane",{attrs:{label:"　注册　",name:"register"}},[r("div",{staticClass:"loginForm"},[r("el-form",{ref:"userForm",attrs:{model:e.userForm,"label-width":"100px",size:"small",rules:e.regRules}},[r("el-form-item",{attrs:{label:"用户组",prop:"user_group_id"}},[r("el-select",{staticStyle:{width:"100%"},model:{value:e.userForm.user_group_id,callback:function(t){e.$set(e.userForm,"user_group_id",t)},expression:"userForm.user_group_id"}},e._l(e.groupOptions,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"校园卡号",prop:"campus_card_id"}},[r("el-input",{staticClass:"logInt",attrs:{clearable:""},model:{value:e.userForm.campus_card_id,callback:function(t){e.$set(e.userForm,"campus_card_id",t)},expression:"userForm.campus_card_id"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"院系",prop:"department"}},[r("el-input",{staticClass:"logInt",attrs:{clearable:""},model:{value:e.userForm.department,callback:function(t){e.$set(e.userForm,"department",t)},expression:"userForm.department"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{staticClass:"logInt",attrs:{placeholder:"务必填写正确邮箱，找回密码时会发送邮件",clearable:""},model:{value:e.userForm.email,callback:function(t){e.$set(e.userForm,"email",t)},expression:"userForm.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"用户名",prop:"name"}},[r("el-input",{staticClass:"logInt",attrs:{clearable:""},model:{value:e.userForm.name,callback:function(t){e.$set(e.userForm,"name",t)},expression:"userForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{staticClass:"logInt",attrs:{clearable:"","show-password":""},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1)],1),e._v(" "),r("el-button",{staticClass:"loginBtn",attrs:{type:"primary"},on:{click:e.execReg}},[e._v(e._s(e.$t("login.register")))])],1)]),e._v(" "),r("el-tab-pane",{attrs:{label:"　找回密码　",name:"forget"}},[r("div",{staticClass:"loginForm"},[r("el-form",{ref:"forgetForm",attrs:{model:e.forgetForm,"label-width":"100px",size:"small",rules:e.forgetRules}},[r("el-form-item",{attrs:{label:e.$t("login.email"),prop:"email"}},[r("el-input",{staticClass:"logInt",attrs:{clearable:""},model:{value:e.forgetForm.email,callback:function(t){e.$set(e.forgetForm,"email",t)},expression:"forgetForm.email"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-s-promotion",title:"发送验证码"},on:{click:e.toSendVcode},slot:"append"})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"验证码",prop:"verification_code"}},[r("el-input",{staticClass:"logInt",attrs:{clearable:""},model:{value:e.forgetForm.verification_code,callback:function(t){e.$set(e.forgetForm,"verification_code",t)},expression:"forgetForm.verification_code"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"重置密码",prop:"password"}},[r("el-input",{staticClass:"logInt",attrs:{"show-password":"",clearable:""},model:{value:e.forgetForm.password,callback:function(t){e.$set(e.forgetForm,"password",t)},expression:"forgetForm.password"}})],1)],1),e._v(" "),r("el-button",{staticClass:"loginBtn",attrs:{type:"primary"},on:{click:e.forgetSub}},[e._v("提交")])],1)])],1),e._v(" "),r("div",{staticClass:"bth"})],1)},staticRenderFns:[]};var l=r("VU/8")(o,i,!1,function(e){r("VWv+")},"data-v-76b94b1f",null);t.default=l.exports},"VWv+":function(e,t){}});
//# sourceMappingURL=2.d39a9e951b72b37fb639.js.map